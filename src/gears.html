<!DOCTYPE html>
<html>
<head>
	
<meta charset="utf-8">

<title>Web Computing</title>

<script type="text/javascript" src="lib/jquery.js"></script>
<script type="text/javascript" src="lib/jquery.tmpl.js"></script>
<script type="text/javascript" src="lib/knockout.js"></script>

<link rel="stylesheet" type="text/css" href="css/style.css" />

</head>
<body>

<div id="top">
	<img data-bind="css : {rotating : running}" src="img/gear1-bw.svg" style="float: left; height: 2.3em; margin: 0.35em;" />
	<span id="appname">GEARS</span>
	<span id="appdescription">the WebComputing grid client</span>
	<div id="runcontrol" data-bind="click : function() {running(!running())}, css : {running : running(), stopped : !running()}" onselectstart="return false;">
   		<span class="stop">&#x25FC</span>
   		<span class="play">&#x25B6</span>
    </div>
   	<div id="threadnumber" onselectstart="return false;">
		<span class="minus" data-bind="click : function() {if (threads() > 1) threads(threads() - 1)}">
       		-
    	</span><span class="number" data-bind="text : threads">
    	</span><span class="plus" data-bind="click : function() {threads(threads() + 1)}">
       		+
        </span>
	</div>
	<span id="threadnumber-description">simultaneously running workunit allowed</span>
	<img id="terminalpanel-button" onclick="select('.panel', '#terminalpanel', true, '#mainpanel')" src="img/terminal.png" />
</div>

<div class="panel" id="terminalpanel">
	Valami
</div>

<div class="panel active" id="mainpanel">
<div id="newworksource" class="worksource" data-bind="css : {active : worksources().length === 0}">
	<h3>Add new worksource</h3>

	<img class="settingsbutton" onclick="$(this).parent().toggleClass('active')" src="img/plus.png" />

	<script type="text/javascript">
		function selectworksource(name) {
			if ($('ul.worksourcetypes li').not('.' + name).hasClass('active'))
			{
				$('ul.worksourcetypes li').not('.' + name).removeClass('active');
			}
			else
			{
				$('ul.worksourcetypes li').addClass('active');			
			}
			select('.createform','.' + name, true);
		}
	</script>

	<ul class="worksourcetypes" data-bind="template: {name : 'worksourcetype'}">
		<script type="text/html" id="worksourcetype">
			{{each(name, worksourcetype) viewModel.worksourcetypes}}
				<li class="active ${ name }" class="worksourcetype" onclick="selectworksource('${ name }')">
					<img title="${ worksourcetype.description }" src="${ worksourcetype.icon }" />
				</li>
			{{/each}}
		</script>
	</ul>
	
	<div class="createform boinc">
		<div class="fieldset">
			<label>Project url:</label>
			<input value="Project url"
			       onkeydown="viewModel.worksourcetypes.boinc.projecturl_ok(false);viewModel.worksourcetypes.boinc.ok(false)"
			       data-bind="value : worksourcetypes.boinc.parameters.url" />
			<button onclick="viewModel.worksourcetypes.boinc.checkprojecturl()">Check</button>
		</div>
		<div class="or">
			<div class="fieldset">
				<label>Username: </label>
				<input data-bind="enable : worksourcetypes.boinc.projecturl_ok,
				                  value : worksourcetypes.boinc.parameters.username"
				       onkeydown="viewModel.worksourcetypes.boinc.ok(false)" />
				<label>Password:</label>
				<input data-bind="enable : worksourcetypes.boinc.projecturl_ok,
				                  value : worksourcetypes.boinc.parameters.password"
				       onkeydown="viewModel.worksourcetypes.boinc.ok(false)" />
				<button data-bind="enable : worksourcetypes.boinc.projecturl_ok"
				        onclick="viewModel.worksourcetypes.boinc.checklogin()">Check</button>
			</div>
			<div class="fieldset">
				<label>Authkey: </label>
				<input data-bind="enable : worksourcetypes.boinc.projecturl_ok,
				                  value : worksourcetypes.boinc.parameters.authkey"
				       onkeydown="viewModel.worksourcetypes.boinc.ok(false)" />
				<button data-bind="enable : worksourcetypes.boinc.projecturl_ok"
				        onclick="viewModel.worksourcetypes.boinc.checkauthkey()">Check</button>
			</div>
		</div>
		<div class="submit">
			<button data-bind="enable : worksourcetypes.boinc.ok">Create</button>
			<p>Lorem ipsum error</p>
		</div>
	</div>

	<div class="createform boincdev">
		<div class="fieldset">
			<label>Scheduler url:</label>
			<input data-bind="value : worksourcetypes.boincdev.parameters.scheduler" />
		</div>
		<div class="fieldset">
			<label>Auth key:</label>
			<input data-bind="value : worksourcetypes.boincdev.parameters.authkey" />
		</div>
		<div class="submit">
			<button data-bind="enable : worksourcetypes.boincdev.ok">Create</button>
			<p>Lorem ipsum error</p>
		</div>
	</div>

</div>

<div id="worksourcelist" data-bind='template: {name : "worksource",
                                               foreach : worksources}'>
	<script type="text/html" id="worksource">
	<div class="worksource">
		<h3 data-bind="text: name"></h3>
		<img class="settingsbutton" onclick="$(this).toggleClass('enabled')" src="img/gear2.svg" />
		<div class="settings">
			<p>Project name: <span data-bind="text : name"></span></p>
			<p>Project scheduler url: <a data-bind="text : scheduler, attr : {href : scheduler}"></a></p>
			<p>Authentication key: <span data-bind="text : authkey"></span></p>
		</div>
		<ul class="workunits" data-bind='template : {name : "workunit",
		                                             foreach : workunits}'>
	    </ul>
	</div>
	</script>
	<script type="text/html" id="workunit">
	<li class="workunit">
		<img class="terminal-icon" data-bind="click : function(){consoleenabled(!consoleenabled());}" src="img/terminal.png"/>
		
		<span class="state" data-bind="text : state"></span>
		
		<div class="meter">
			<span style="width : 50%"></span>
		</div>
		
		<textarea class="terminal" data-bind="value : console,
		                                      style : {display : consoleenabled() ? 'block' : 'none'}">
		</textarea>
	</li>
	</script>
</div>
</div>

<script type="text/javascript">
var select = function(set, select, unselect, defaultSelect)
{
	//console.log(select);
	set = $(set);
	var target = set.filter(select);
	if (unselect === true && target.hasClass('active'))
	{
		target.removeClass('active');
		if (typeof(defaultSelect) != 'undefined')
		{
			set.filter(defaultSelect).addClass('active');
		}
		return;
	}
	set.filter('.active').removeClass('active');
	target.addClass('active');
}

var togglePanel = function(panelId)
{
	var selected = $('.panel').filter('.active')[0];
	$('.panel').filter('.active').removeClass('active');
	if (selected.getAttribute('id') === panelId)
	{
		$('#mainpanel').addClass('active');
	} else {
		$('#' + panelId).addClass('active');
	}
}

</script>

<script type="text/javascript" src="js/viewmodel.js"></script>
<script type="text/javascript" src="js/boincdev.js"></script>
<script type="text/javascript" src="js/boinc.js"></script>

<script type="text/javascript">
  ko.applyBindings(window.viewModel);
</script>

</body>
</html>
