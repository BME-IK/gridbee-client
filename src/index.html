<!DOCTYPE html>
<html>
<head>
	
<meta charset="utf-8">

<title>Web Computing</title>

<script type="text/javascript" src="lib/jquery.js"></script>
<script type="text/javascript" src="lib/jquery.tmpl.js"></script>
<script type="text/javascript" src="lib/knockout.js"></script>
<script language="JavaScript" src="js/SimpleClient.js"></script>

<link rel="stylesheet" type="text/css" href="css/style.css" />

</head>
<body onload="onLoad()">

<pre id="haxe:trace" style="display:none"></pre>

<div id="top">
	<img data-bind="css : {rotating : running}" src="img/gear1-bw.svg" style="float: left; height: 2.3em; margin: 0.35em;" />
	<span id="appname">GEARS</span>
	<span id="appdescription">the WebComputing grid client</span>
	<div id="runcontrol" data-bind="click : function() {running(!running())}, css : {running : running(), stopped : !running()}" onselectstart="return false;">
   		<span class="stop">&#x25FC</span>
   		<span class="play">&#x25B6</span>
    </div>
   	<div id="threadnumber" onselectstart="return false;">
		<span class="minus" data-bind="click : function() {if (threads() > 1) threads(threads() - 1)}">
       		-
    	</span><span class="number" data-bind="text : threads">
    	</span><span class="plus" data-bind="click : function() {threads(threads() + 1)}">
       		+
        </span>
	</div>
	<span id="threadnumber-description">simultaneously running workunit allowed</span>
	<img id="terminalpanel-button" onclick="select('.panel', '#log', true, '#mainpanel'); $(this).toggleClass('active')" src="img/terminal.png" />
</div>

<div class="panel console" id="log">
	Valami
</div>
<div class="panel active" id="mainpanel">
<div id="newworksource" class="worksource">
	<h3>Add new worksource</h3>
	<script type="text/javascript">
		function selectworksource(name) {
			if ($('ul.worksourcetypes li').not('.' + name).hasClass('active'))
			{
				$('ul.worksourcetypes li').not('.' + name).removeClass('active');
			}
			else
			{
				$('ul.worksourcetypes li').addClass('active');			
			}
			select('.createform','.' + name, true);
		}
	</script>

<!--	<ul class="worksourcetypes" data-bind="template: {name : 'worksourcetype'}" >
		<script type="text/html" id="worksourcetype">
			{{each(name, worksourcetype) viewModel.worksourcetypes}} 
				<li class="active ${ name }" class="worksourcetype" onclick="selectworksource('${ name }')">
					<img title="${ worksourcetype.description }" src="${ worksourcetype.icon }" />
				</li>
			{{/each}}
		</script>-->
	<ul class="worksourcetypes">
		<li class="active boincdev" class="worksourcetype">
			<img src="http://boinc.berkeley.edu/logo/www_logo.gif" />
		</li>
	</ul>
	
	<div class="createform boinc">
		<div class="fieldset">
			<label>Project url:</label>
			<input value="Project url"
			       onkeydown="viewModel.worksourcetypes.boinc.projecturl_ok(false);viewModel.worksourcetypes.boinc.ok(false)"
			       data-bind="value : worksourcetypes.boinc.parameters.url" />
			<button onclick="viewModel.worksourcetypes.boinc.checkprojecturl()">Check</button>
		</div>
		<div class="or">
			<div class="fieldset">
				<label>Username: </label>
				<input data-bind="enable : worksourcetypes.boinc.projecturl_ok,
				                  value : worksourcetypes.boinc.parameters.username"
				       onkeydown="viewModel.worksourcetypes.boinc.ok(false)" />
				<label>Password:</label>
				<input data-bind="enable : worksourcetypes.boinc.projecturl_ok,
				                  value : worksourcetypes.boinc.parameters.password"
				       onkeydown="viewModel.worksourcetypes.boinc.ok(false)" />
				<button data-bind="enable : worksourcetypes.boinc.projecturl_ok"
				        onclick="viewModel.worksourcetypes.boinc.checklogin()">Check</button>
			</div>
			<div class="fieldset">
				<label>Authkey: </label>
				<input data-bind="enable : worksourcetypes.boinc.projecturl_ok,
				                  value : worksourcetypes.boinc.parameters.authkey"
				       onkeydown="viewModel.worksourcetypes.boinc.ok(false)" />
				<button data-bind="enable : worksourcetypes.boinc.projecturl_ok"
				        onclick="viewModel.worksourcetypes.boinc.checkauthkey()">Check</button>
			</div>
		</div>
		<div class="submit">
			<button data-bind="enable : worksourcetypes.boinc.ok">Create</button>
			<p>Lorem ipsum error</p>
		</div>
	</div>

	<div class="createform boincdev active">
		<div class="fieldset">
			<label>Scheduler url:</label>
			<input data-bind="value : worksourcetypes.boincdev.parameters.scheduler" />
		</div>
		<div class="fieldset">
			<label>Auth key:</label>
			<input data-bind="value : worksourcetypes.boincdev.parameters.authkey" />
		</div>
		<div class="submit">
			<button data-bind="enable : worksourcetypes.boincdev.ok, click : worksourcetypes.boincdev.create">Create</button>
			<p></p>
		</div>
	</div>
</div>

<div id="worksource_list" style="display: none"></div>

<div id="worksourcelist" data-bind='template: {name : "projectFrame",
	                                           foreach : projects}'>
	<script type="text/html" id="projectFrame">
	<div class="worksource">
		<h3 data-bind="text: name"></h3>
		<img class="settingsbutton" data-bind="click : function(){boincdev_remove($data);}" src="img/close.png" />
		<img class="settingsbutton" onclick="$(this).toggleClass('enabled')" style="right: 5em" src="img/gear2.svg" />
		<div class="settings">
			<p>Project name: <span data-bind="text : name"></span></p>
			<p>Project url: <a data-bind="text : url, attr : {href : url}"></a></p>
			<p>Authentication key: <span data-bind="text : authkey"></span></p>
		</div>
		<ul class="workunits" data-bind='template : {name : "workunit",
		                                             foreach : workunits}'>
	    </ul>
	</div>
	</script>
	<script type="text/html" id="workunit">
	<li class="workunit">
		<img class="terminal-icon" data-bind="click : function(){consoleenabled(!consoleenabled());}" src="img/terminal.png"/>
		
		<span class="state" data-bind="text : state"></span>
		
		<div class="meter">
			<span data-bind="style : {width : progress() + '%'}"></span>
		</div>
		
		<div class="terminal" id="${workunit.name}-terminal" data-bind="style : {display : consoleenabled() ? 'block' : 'none'}">
		</div>
		<span style="display: none" data-bind="html : updateConsole(console, workunit.name + '-terminal')"></span>
	</li>
	</script>
	<script type="text/javascript">
		function updateConsole(console, id) {
			console.subscribe(function(newValue){
				var logdiv = $('#' + id)[0];
				if (logdiv.scrollTop >= logdiv.scrollHeight - logdiv.clientHeight - 10)
				{
					scrolling = true;
				}
				$(logdiv).html(newValue);
				if (scrolling)
				{
					logdiv.scrollTop = logdiv.scrollHeight;
				}
			});
			return '';
		}
	</script>
</div>
</div>

<script type="text/javascript" src="js/viewmodel.js"></script>
<script type="text/javascript" src="js/boincdev.js"></script>

</body>
</html>