<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8">

<title>Gridbee Grid Client</title>

<script type="text/javascript" src="lib/jquery.js"></script>
<script type="text/javascript" src="lib/jquery.tmpl.js"></script>
<script type="text/javascript" src="lib/knockout.js"></script>
<script type="text/javascript" src="lib/framework.js"></script>
<script type="text/javascript" src="gridbee.js"></script>

<link rel="stylesheet" type="text/css" href="gridbee.css" />

</head>
<body>

<div id="app-name"> GRIDBEE </div>
<div id="app-description"> the grid computing web app </div>

<div id="runcontrol" onselectstart="return false;"
     data-bind="click : function() {running(!running());},
                css : {running : running(), stopped : !running()}">
  <span class="stop">&#x25FC</span>
  <span class="play">&#x25B6</span>
</div>

<div id="threadnumber" onselectstart="return false;">
  <span class="minus"
        data-bind="click : function() {threads(Math.min(1,threads()-1))}">
    -
  </span>
  <span class="number" data-bind="text : threads"></span>
  <span class="plus"
        data-bind="click : function() {threads(threads() + 1)}">
    +
  </span>
</div>

<div id="state-describtion">
  <b>Running</b> on <b>3</b> threads
</div>

<div id="newworksource">

  <div class="leftpanel">

    <ul data-bind="template : {name : 'informationform', foreach : templates}">
      <script type="text/html" id="informationform">
      <li data-bind="attr : {templatename : templatename}"
          onclick="selectTemplate(this.getAttribute('templatename'))">
        <h2 class="selectable selector"
            data-bind="text : formtitle">
        </h2>

        <p data-bind="text : description">
        </p>
      </li>
      </script>
    </ul>

  </div>

  <div class="rightpanel">

    <h1 class="selectable selector"
        onclick="selectItem(this)">
      Add new worksource
    </h1>

  </div>

</div>

<script>
  function selectItem(h1) {
    $('#worksourcelist .worksource, #newworksource').removeClass('selected')
    $(h1).parent().parent().addClass('selected')
  }

  function setNewWorksourceHeight() {
    var leftheight = $('#newworksource .leftpanel').outerHeight();
    var rightheight = $('#newworksource .rightpanel').outerHeight() + 
                      $('#templatelist').outerHeight();
    var margin = Math.max(0, leftheight - rightheight);
    $('#templatelist').css('margin-bottom', margin);
    console.log(leftheight, rightheight, margin);
  }

  function selectTemplate(templatename) {
    selector = $('#newworksource li[templatename="' + templatename + '"]');
    template = $('#templatelist li[templatename="' + templatename + '"]');

    selector.addClass('selected')
            .siblings().removeClass('selected');

    template.addClass('selected')
            .siblings().removeClass('selected');

    //setNewWorksourceHeight();
  }

  //$('#newworksource .rightpanel h1').click(setNewWorksourceHeight);

  function checkNonEmptyInputs(e) {
    if (e.target.tagName.toLowerCase() !== 'input') return;
    console.log(e.charCode);

    var input = $(e.target);
    if (e.charCode !== 0) {
      input.addClass('nonempty');
    } else {
      if (input.val().length > 0) {
        input.addClass('nonempty');
      } else {
        input.removeClass('nonempty');
      }
    }
  }
  document.addEventListener('keypress', checkNonEmptyInputs, false);
  document.addEventListener('keyup', checkNonEmptyInputs, false);
</script>

<ul id="templatelist"
     data-bind="template: {name : 'worksource', foreach : templates}">
</ul>

<ul id="worksourcelist"
     data-bind="template: {name : 'worksource', foreach : worksources}">

  <script type="text/html" id="worksource">
    <li class="worksource"
        data-bind="attr : {templatename : living() ? '' : templatename}">

      <ul class="leftpanel"
          data-bind="template : {name : 'workunit', foreach : workunits}">
      </ul>

      <div class="rightpanel">
        <h1 class="selectable selector"
            data-bind="text : name"
            onclick="selectItem(this)">
        </h1>
        <h2 data-bind="text : console.log($data.name)"></h2>
        <form class="overview"
              data-bind="template : {name : 'informationform-' + type, data : $data}">
        </form>
      </div>

    </li>
  </script>

  <script type="text/html" id="workunit">
    <li class="workunit">
      <span class="status"
            data-bind="text : status">
      </span>

      <div class="meter">
        <span data-bind="style : {width : progress()*100 + '%'}">
      </div>
    </li>
  </script>

</ul>

</body>
</html>
